#!/usr/bin/env node
import fs from 'fs';
import path from 'path';
import readline from 'readline';

const projectRoot = process.cwd();
const stylesDir = path.join(projectRoot, 'styles', 'fonts');
const packageDir = path.dirname(new URL(import.meta.url).pathname);
const fontsDir = path.join(packageDir, '..', 'fonts');

// Ensure styles/fonts directory exists
fs.mkdirSync(stylesDir, { recursive: true });

// Get list of available fonts
const availableFonts = fs.readdirSync(fontsDir).filter(f =>
  fs.lstatSync(path.join(fontsDir, f)).isDirectory()
);

console.log("\nðŸ“ Available Fonts:");
availableFonts.forEach((f, i) => console.log(` ${i + 1}. ${f}`));

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

rl.question("\nðŸ‘‰ Choose a font by number: ", (answer) => {
  const index = parseInt(answer) - 1;

  if (index < 0 || index >= availableFonts.length) {
    console.log("âŒ Invalid choice.");
    rl.close();
    return;
  }

  const chosenFont = availableFonts[index];
  const source = path.join(fontsDir, chosenFont);
  const destination = path.join(stylesDir, chosenFont);

  // Create destination folder
  fs.mkdirSync(destination, { recursive: true });

  // Copy every file inside the font folder
  const files = fs.readdirSync(source);
  files.forEach(file => {
    fs.copyFileSync(
      path.join(source, file),
      path.join(destination, file)
    );
  });

  console.log(`\nâœ… ${chosenFont} installed to styles/fonts/${chosenFont}`);
  console.log("\nðŸ“Œ Import it in your main.css or main.jsx:");
  console.log('')
  console.log('')
  console.log(`\x1b[34m @import './styles/fonts/${chosenFont}/index.css'; \x1b[0m`);
  console.log('')
  console.log('')

  rl.close();
});